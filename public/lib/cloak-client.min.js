/* cloak client */
!function(){var a=function(){var a,b,c,d,e={},f={},g={},h={},i={_setLibs:function(a,b){_=a,io=b},configure:function(a){_(a).forEach(function(a,b){"serverEvents"===b?_(a).forEach(function(a,b){i._on("cloak-"+b,a)}):"timerEvents"===b?g=a:f[b]=a})},_on:function(a,b){void 0===e[a]&&(e[a]=[]),e[a].push(b)},_off:function(a,b){e[a]=_(e[a]).without(b)},_trigger:function(a,b){void 0!==e[a]&&_.forEach(e[a],function(a){a(b)})},run:function(e){c=e,b=io.connect(c,{"force new connection":!0}),b.on("error",function(a){i._trigger("cloak-error",a)}),b.on("connect_error",function(){i._trigger("cloak-error","Connect error")}),b.on("connect_timeout",function(){i._trigger("cloak-error","Connect timeout")}),b.on("connect",function(){void 0===a?b.emit("cloak-begin",{}):b.emit("cloak-resume",{uid:a})}),b.on("disconnect",function(){i._trigger("cloak-disconnect")}),b.on("connecting",function(){i._trigger("cloak-connecting")}),b.on("cloak-roomMemberJoined",function(a){i._trigger("cloak-roomMemberJoined",a)}),b.on("cloak-roomMemberLeft",function(a){i._trigger("cloak-roomMemberLeft",a)}),b.on("cloak-lobbyMemberJoined",function(a){i._trigger("cloak-lobbyMemberJoined",a)}),b.on("cloak-lobbyMemberLeft",function(a){i._trigger("cloak-lobbyMemberLeft",a)}),b.on("cloak-joinedRoom",function(a){i._trigger("cloak-joinedRoom",a)}),b.on("cloak-leftRoom",function(a){i._trigger("cloak-leftRoom",a)}),b.on("cloak-roomCreated",function(a){i._trigger("cloak-roomCreated",a)}),b.on("cloak-roomDeleted",function(a){i._trigger("cloak-roomDeleted",a)}),b.on("cloak-beginResponse",function(b){a=b.uid,d=b.config,i._trigger("cloak-begin")}),b.on("cloak-resumeResponse",function(a){a.valid?(d=a.config,i._trigger("cloak-resume")):(i._trigger("cloak-error","Could not resume."),i.stop())}),b.on("cloak-syncTimer",function(a){var b=g[a.name];if(void 0!==b){var c=a.value;a.running&&a.descending?c-=(new Date).getTime()-a.sent:a.running&&(c+=(new Date).getTime()-a.sent),b(c)}}),_(f.messages).forEach(function(a,c){b.on("message-"+c,function(a){i._trigger("message-"+c,a)}),i._on("message-"+c,a)})},stop:function(){this._disconnect(),i._trigger("cloak-end")},_disconnect:function(){b.disconnect()},_connect:function(){b.socket.connect()},connected:function(){return b.socket.connected},_callback:function(a,b){void 0===h[a]&&(h[a]=[]),h[a].push(b)},message:function(a,c){if(!this.connected())throw"Not connected.";b.emit("message-"+a,c)}};return i};"undefined"==typeof window?module.exports=a:cloak=a()}();